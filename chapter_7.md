### chap.7 시스템 버스, I/O 및 인터럽트

#### 7.1 시스템 버스

**7.1.1 시스템 버스의 조직**

시스템 버스는 데이터버스, 주소 버스, 제어 버스로 구성되어있다.

- 버스 마스터: 시스템 버스에 접속되는 요소들 중 버스 사용의 주체가 되는 요소들을 버스 마스터라 한다.
- 버스 중재: 두 개 이상의 버스 마스터들이 동시에 버스 사용을 요청할 경우 순서를 결정해주는 시스템 동작.
  - 버스 요구 신호: 버스 마스터가 버스 사용을 원하고 있음을 나타냄
  - 버스 승인 신호: 버스 사용을 허가하는 신호
  - 버스 사용중 신호: 어떤 마스터가 버스를 사용하고 있는 중을 나타내는 신호
- 버스 중재를 위한 신호 선들의 집합을 중재 버스라 함.



**7.1.2 시스템 버스의 기본 동작**

- 쓰기 동작: 
  1. 버스 마스터가 버스 사용권을 획득한다.
  2. 버스를 통하여 주소와 데이터 및 쓰기 신호를 보낸다.
- 읽기 동작:
  1. 버스 마스터가 버스 사용권을 획득한다.
  2. 주소와 읽기 신호를 보내고, 데이터가 전송되어 올 때까지 기다린다.



 데이터 전송 방법:

- 동기식 버스: 공통의 버스 클록을 기준으로 버스 동작들이 발생되는 버스
  - 단순, 낭비되는 시간이 있음.

- 비동기식 버스: 버스 클록을 사용하지 않으며, 버스 동작들의 발생 시간이 다른 관련 동작의 발생에 따라 결정되는 버스
  - 복잡, 낭비되는 시간이 없음.



#### 7.2 버스 중재

 여러 개의 버스 마스터들이 동시에 버스 사용을 요구하는 경우 경쟁이 발생하는 상황에서 버스의 사용순서를 정해주는 동작을 버스 중재라 함.

 버스 중재 방식은 여러 가지가 있다.

- 병렬 중재 방식: 각 버스 마스터가 독립적인 버스 요구 신호를 갖고 있다.
- 직렬 중재 방식: 버스 요구 및 승인 신호 선이 버스 마스터들 간에 직렬로 접속된다.
- 중앙집중식 중재 방식: 한 개의 버스 중재기가 모든 버스 중재 기능을 수행.
- 분산식 중재 방식: 버스 중재 동작이 각 버스 마스터가 별도로 가지고 있는 버스 중재기들에 의해 이루어지는 방식.



**7.2.1 병렬 중재 방식**

1. 중앙집중식 고정-우선순위 방식

   - 고정-우선순위 방식: 
     1. 마스터3이 버스 요구 신호 set
     2. 버스 중재기가 버스 승인 신호 set
     3. 마스터1이 버스 사용중 신호 reset
     4. 마스터3이 버스 사용중 신호 set, 버스 사용 시작, 버스 요구 신호 및 버스 승인 신호 reset

2. 분산식 고정-우선순위 방식

    모든 버스 마스터들이 중재기를 한 개씩 갖고 있다. 각 버스 마스터의 중재기는 자신보다 더 높은 우선순위를 가진 버스 마스터들의 버스 요구 신호들을 입력으로 받아서 검사하고, 그들 중의 어느 것도 버스 사용 요구를 하지 않은 경우에만 자신의 버스 승인 신호를 set한다.

3. 가변 우선순위 방식

    버스 중재기가 시스템의 상태에 따라 각 버스 마스터들의 우선순위를 계속 바꾸어 준다. 버스 사용 기회의 불균등이나 기근 현상을 방지해주지만 회로 구현이 어렵다.

   - 회전 우선순위 방식: 마스터들의 우선순위가 회전되는 방식으로 순환된다.
   - 임의 우선순위 방식: 마스터들의 우선순위가 계속적으로 무작위로 정해진다.
   - 동등 우선순위 방식: 비동기식 버스 시스템에서만 사용가능, 모든 마스터들이 동등한 우선순위. FIFO.
   - 최소-최근 사용 방식: 가장 오랫동안 버스를 사용하지 않은 버스 마스터에게 최상위 우선순위 부여.



**7.2.2 직렬 중재 방식**

버스 요구 신호와 버스 승인 신호가 하나씩만 있다.

1. 중앙집중식 직렬 중재 방식: 버스요구가 들어오면 승인을 우선순위가 높은것부터 차례대로 검사하고, 요구한 마스터를 찾으면 승인한다.
2. 분산식 직렬 중재 방식: 각 버스 마스터당 중재기를 주어 서로 요구와 승인을 처리하고, 기아현상을 방지하기 위해 접근하는 중재신호를 루프 돌린다.



**7.2.3 폴링 방식**

 버스 중재기가 각 마스터들이 버스 사용을 원하는지를 주기적으로 검사하여 버스 승인 여부를 결정.

1. 하드웨어 폴링 방식
2. 소프트웨어 폴링 방식



#### 7.3 I/O 장치의 접속

**7.3.1 I/O 제어**

 각종 I/O 장치들은 시스템 버스를 통해 CPU 혹은 주기억장치와 정보를 교환한다. 시스템 버스와 I/O 장치를 연결해주는 인터페이스 역할을 I/O 제어기가 해준다.

**7.3.2 I/O 주소지정**

1. 기억장치-사상 I/O: I/O 제어기 내의 레지스터들에게 기억장치 주소 영역의 일부분을 할당하고, 기억장치와 같은 방법으로 액세스하는 방식
2. 분리형 I/O: I/O 장치들에 별도의 I/O 주소 영역을 지정하고, I/O 전용 명령어들을 이용하여 액세스하는 방식



#### 7.4 인터럽트를 이용한 I/O

 인터럽트 메커니즘을 이용하여 CPU와 I/O 장치간의 상호작용이 처리되는 방식.

**7.4.1 다중 인터럽트 방식**

 각 I/O 제어기와 CPU 사이에 별도의 인터럽트 요구, 인터럽트 확인 신호선이 한 개씩 존재하는 방식.

​	장점: 별도의 인터럽트 선을 갖고 있기 때문에 CPU가 인터럽트를 요구한 장치를 쉽게 찾아낼 수 있다.

​	단점: 하드웨어가 복잡하며 CPU 칩의 핀 수에 의해 접속 가능한 I/O 장치의 수가 제한된다.

**7.4.2 데이지-체인 방식**

 1개의 인터럽트요구신호, 체인방식인 1개의 인터럽트확인신호, 데이터버스를통해 인터럽트벡터(인터럽트 처리 루틴의 시작 주소)를 보냄

​	장점: 하드웨어가 간단

​	단점: 우선순위가 낮은 장치들의 대기시간이 길어짐

**7.4.3 소프트웨어 폴링 방식**

 1개의 인터럽트요구신호, 제어기 내 인터럽트플래그가 내장되어있고, TEST I/O로 요구한 I/O제어기를 찾는다.

​	장점: 하드웨어가 간단

​	단점: 검사를 위한 시간이 많이 걸림



#### 7.5 DMA를 이용한 I/O

 DMA: CPU의 개입이 없는 데이터 전송 수행 메커니즘

 DMA 제어기: CPU 개입 없이 I/O 장치와 기억장치 간의 데이터 전송을 수행하는 DMA 동작을 지원하는 하드웨어 모듈을 말한다.

 CPU는 정보를 DMA 제어기로 보낸 후 다른 일을 계속한다. 즉, DMA 제어기가 I/O 동작을 전부 담당한다. CPU가 버스를 쓰지 않는 동안 DMA가 시스템 버스를 사용한다. 이를 사이클 스틸링이라 한다.

- 단점: 
  1. 간단한 DMA 제어기로 지원하는데에 한계가 있다. (I/O장치의 다양성 + 복잡함때문)
  2. 버퍼링을 위한 내부기억장치가 필요하다.



